<!DOCTYPE html>
<!--
Author: Keenthemes
Product Name: Metronic
Product Version: 8.1.8
Purchase: https://1.envato.market/EA4JP
Website: http://www.keenthemes.com
Contact: support@keenthemes.com
Follow: www.twitter.com/keenthemes
Dribbble: www.dribbble.com/keenthemes
Like: www.facebook.com/keenthemes
License: For each use you must have a valid license purchased only from above link in order to legally use the theme for your project.
-->
<html lang="en">
<!--begin::Head-->

<head>
    <base href="" />
    <title>Smart Watch</title>
    <meta charset="utf-8" />

    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="article" />

    <link rel="shortcut icon" href="assets/media/logos/favicon.ico" />
    <!--begin::Fonts(mandatory for all pages)-->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,400,500,600,700" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Kanit:300,400,500,600,700" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Sarabun:300,400,500,600,700" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans+Thai:300,400,500,600,700" />


    <!--end::Fonts-->

    <!--end::Vendor Stylesheets-->
    <!--begin::Global Stylesheets Bundle(mandatory for all pages)-->
    <link href="assets/plugins/global/plugins.bundle.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/style.bundle.css" rel="stylesheet" type="text/css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.11.3/viewer.min.css" rel="stylesheet"
        type="text/css" />
    <link href="https://vjs.zencdn.net/8.3.0/video-js.css" rel="stylesheet" />
    <style>
        .f_green {
            color: #006838;
        }
    </style>
    <!--end::Global Stylesheets Bundle-->
    <script>
        // Frame-busting to prevent site from being loaded within a frame without permission (click-jacking) if (window.top != window.self) { window.top.location.replace(window.self.location.href); }
    </script>
</head>
<!--end::Head-->
<!--begin::Body-->

<body id="kt_app_body" data-kt-app-header-fixed="true" data-kt-app-header-fixed-mobile="true"
    data-kt-app-sidebar-enabled="true" data-kt-app-sidebar-fixed="true" data-kt-app-sidebar-push-toolbar="true"
    data-kt-app-sidebar-push-footer="true" data-kt-app-toolbar-enabled="true" class="app-default">
    <!--begin::Theme mode setup on page load-->

    <!--end::Theme mode setup on page load-->
    <!--begin::App-->
    <div class="d-flex flex-column flex-root app-root" id="kt_app_root">
        <!--begin::Page-->
        <div class="app-page flex-column flex-column-fluid" id="kt_app_page">

            <!--begin::Wrapper-->
            <div class=" d-flex" id="kt_app_wrapper">
                <!--begin::Wrapper container-->
                <div class="app-container container-fluid">
                    <!--begin::Sidebar-->

                    <div class="app-main flex-column flex-row-fluid" id="kt_app_main">
                        <!--begin::Content wrapper-->
                        <div class="d-flex flex-column flex-column-fluid">

                            <!--begin::Content-->
                            <div id="kt_app_content" class="app-content">
                                <!--begin::Row-->
                                <div class="row gx-5 gx-xl-10">
                                    <!--begin::Col-->
                                    <div class="col-xxl mb-5 mb-xl-10">
                                        <!--begin::Chart widget 27-->
                                        <div class="card card-flush h-xl-100">

                                            <!--begin::Body-->
                                            <div class="card-body pt-0 pb-1">




                                                <div class="py-5">
                                                    <div class="row ">

                                                        <ul class="nav nav-tabs nav-line-tabs mb-5 fs-6">
                                                            <li class="nav-item col-md">
                                                                <a href="#kt_tab_pane_1"
                                                                    class="card hover-elevate-up shadow-sm parent-hover nav-link active "
                                                                    data-bs-toggle="tab">
                                                                    <div class="card-body d-flex align-items  center">

                                                                        <span
                                                                            class=" text-gray-900 parent-hover-primary fs-2 fw-bold  text-center f_green">
                                                                            Smart Watch
                                                                        </span>
                                                                    </div>
                                                                </a>
                                                            </li>
                                                            <li class="nav-item col-md">
                                                                <a href="#kt_tab_pane_2"
                                                                    class="card hover-elevate-up shadow-sm parent-hover nav-link"
                                                                    data-bs-toggle="tab">
                                                                    <div class="card-body d-flex align-items">

                                                                        <span
                                                                            class="  text-gray-900 parent-hover-primary fs-2 fw-bold f_green">
                                                                            Camera
                                                                        </span>
                                                                    </div>
                                                                </a>
                                                            </li>

                                                        </ul>

                                                    </div>
                                                </div>


                                            </div>
                                            <!--end::Body-->
                                        </div>
                                        <!--end::Chart widget 27-->
                                    </div>
                                    <!--end::Col-->

                                </div>



                                <div class="tab-content" id="myTabContent">
                                    <div class="card-header pt-5 pb-4">
                                        <!--begin::Title-->
                                        <h3 class="card-title align-items-start flex-column">
                                            <span class="card-label fw-bold  f_green" style="color: #006838;">Smart
                                                Watch</span>
                                            <!-- <span class="text-gray-400 mt-1 fw-semibold fs-6">1,046 Inbound Calls today</span> -->
                                        </h3>
                                        <!--end::Title-->

                                        <!--begin::Toolbar-->
                                        <div class="card-toolbar">

                                            <select class="form-select" aria-label="imei" id="select_imei">
                                                <!-- <option>Open this select menu</option> -->


                                            </select>
                                            <!--end::Daterangepicker-->
                                        </div>
                                        <!--end::Toolbar-->
                                    </div>
                                    <div class="tab-pane fade show active" id="kt_tab_pane_1" role="tabpanel">

                                        <div class="row gx-5 gx-xl-10">
                                            <!--begin::Col-->
                                            <div class="col-xxl mb-5 mb-xl-10">
                                                <!--begin::Chart widget 27-->
                                                <div class="card card-flush h-xl-100">
                                                    <!--begin::Header-->
                                                    <div class="card-header py-7">
                                                        <!--begin::Statistics-->
                                                        <div class="m-0">
                                                            <!--begin::Heading-->
                                                            <div class="d-flex align-items-center mb-2">
                                                                <!--begin::Title-->
                                                                <span
                                                                    class=" fs-2 fw-bold me-2 lh-1 ls-n2 f_green">ข้อมูล
                                                                    Smart Watch </span>
                                                                <!--end::Title-->

                                                            </div>
                                                            <!--end::Heading-->
                                                            <!--begin::Description-->
                                                            <span class="fs-6 fw-semibold text-gray-400" id='txt_imei'>
                                                                -
                                                            </span>
                                                            <!--end::Description-->
                                                        </div>
                                                        <!--end::Statistics-->
                                                    </div>
                                                    <!--end::Header-->
                                                    <!--begin::Body-->
                                                    <div class="card-body pt-0 pb-1">
                                                        <h6 class="mb-8 fw-bolder fs-4 f_green">ข้อมูลการบันทึกล่าสุด
                                                        </h6>

                                                        <div class="row">



                                                            <div class="row">
                                                                <div class="mb-12 col-md">
                                                                    <div class="fw-bold  fs-4 f_green">
                                                                        วันที่อัปเดตข้อมูล
                                                                    </div>
                                                                    <div class="fw-semibold text-gray-600 fs-4"
                                                                        id="txt_last_update">6 กรกฎาคม 2566 09:00 น.
                                                                    </div>
                                                                </div>

                                                            </div>


                                                            <div class="row">
                                                                <div class="mb-12 col-md">
                                                                    <div class="fw-bold  fs-4 f_green">อุณหภูมิ
                                                                    </div>
                                                                    <div class="fw-semibold text-gray-600 fs-4"
                                                                        id="txt_temperature">-</div>
                                                                </div>
                                                                <div class="mb-12 col-md">
                                                                    <div class="fw-bold  fs-4 f_green">
                                                                        อัตราการเต้นของหัวใจ
                                                                    </div>
                                                                    <div class="fw-semibold text-gray-600 fs-4"
                                                                        id="txt_heart_rate">-</div>
                                                                </div>
                                                                <div class="mb-12 col-md">
                                                                    <div class="fw-bold  fs-4 f_green">ความดันโลหิต
                                                                    </div>
                                                                    <div class="fw-semibold text-gray-600 fs-4"
                                                                        id="txt_sbp">-
                                                                    </div>
                                                                </div>
                                                                <div class="mb-12 col-md">
                                                                    <div class="fw-bold  fs-4 f_green">
                                                                        ออกซิเจนในเลือด
                                                                    </div>
                                                                    <div class="fw-semibold text-gray-600 fs-4"
                                                                        id="txt_spo2">
                                                                        -</div>
                                                                </div>


                                                            </div>
                                                        </div>

                                                    </div>
                                                    <!--end::Body-->
                                                </div>
                                                <!--end::Chart widget 27-->
                                            </div>
                                            <!--end::Col-->

                                        </div>



                                        <div class="row gx-5 gx-xl-10">
                                            <!--begin::Col-->
                                            <div class="col-xxl mb-5 mb-xl-10">
                                                <!--begin::Chart widget 27-->
                                                <div class="card card-flush h-xl-100">
                                                    <!--begin::Header-->
                                                    <div class="card-header pt-5">
                                                        <!--begin::Title-->
                                                        <h3 class="card-title align-items-start flex-column">
                                                            <span class="card-label fw-bold  f_green"
                                                                style="color: #006838;">ประวัติการบันทึก</span>
                                                            <!-- <span class="text-gray-400 mt-1 fw-semibold fs-6">1,046 Inbound Calls today</span> -->
                                                        </h3>
                                                        <!--end::Title-->

                                                        <!--begin::Toolbar-->
                                                        <div class="card-toolbar">

                                                            <select class="form-select" aria-label="เลือก..."
                                                                id='select_type'>
                                                                <!-- <option>Open this select menu</option> -->
                                                                <option value="heartrate">อัตราการเต้นของหัวใจ</option>
                                                                <option value="temperature">อุณหภูมิ</option>
                                                                <option value="sbp">ความดันโลหิต</option>
                                                                <option value="spo2">ค่าออกซิเจนในเลือด</option>

                                                            </select>
                                                            <!--end::Daterangepicker-->
                                                        </div>
                                                        <!--end::Toolbar-->
                                                    </div>
                                                    <!--end::Header-->
                                                    <!--begin::Body-->
                                                    <div class="card-body pt-0 pb-1">

                                                        <div class="row">




                                                            <div class="mb-12 col-md-12">
                                                                <div id="kt_amcharts" style="height: 500px;"></div>
                                                                <div id="kt_amcharts2" style="height: 500px;"></div>

                                                            </div>






                                                        </div>

                                                    </div>
                                                    <!--end::Body-->
                                                </div>
                                                <!--end::Chart widget 27-->
                                            </div>
                                            <!--end::Col-->

                                        </div>
                                    </div>



                                    <div class="tab-pane fade" id="kt_tab_pane_2" role="tabpanel">
                                        <div class="row gx-5 gx-xl-10">
                                            <!--begin::Col-->
                                            <div class="col-xxl mb-5 mb-xl-10">
                                                <!--begin::Chart widget 27-->
                                                <div class="card card-flush h-xl-100">
                                                    <!--begin::Header-->
                                                    <div class="card-header py-7">
                                                        <!--begin::Statistics-->
                                                        <div class="m-0">
                                                            <!--begin::Heading-->
                                                            <div class="d-flex align-items-center mb-2">
                                                                <!--begin::Title-->
                                                                <span
                                                                    class="fs-2 fw-bold text-gray-800 me-2 lh-1 ls-n2">Camera</span>
                                                                <!--end::Title-->

                                                            </div>
                                                            <!--end::Heading-->

                                                        </div>
                                                        <!--end::Statistics-->
                                                    </div>
                                                    <!--end::Header-->
                                                    <!--begin::Body-->
                                                    <div class="card-body pt-0 pb-1">


                                                        <div class="row">

                                                            <!-- <video src="http://pistream.pistreamplus.com/hls/paisarn001.m3u8"></video> -->

                                                            <video id='hls-example' class="video-js vjs-default-skin"
                                                                height="600" controls>
                                                                <source type="application/x-mpegURL"
                                                                    id='hls-example-source'
                                                                    src="http://pistream.plutopistream.com/hls/smarteye22.m3u8">
                                                            </video>

                                                        </div>

                                                    </div>
                                                    <!--end::Body-->
                                                </div>
                                                <!--end::Chart widget 27-->
                                            </div>
                                            <!--end::Col-->

                                        </div>


                                    </div>

                                </div>


                            </div>
                            <!--end::Content-->
                        </div>
                        <!--end::Content wrapper-->

                    </div>
                    <!--end:::Main-->
                </div>
                <!--end::Wrapper container-->
            </div>
            <!--end::Wrapper-->
        </div>
        <!--end::Page-->
    </div>
    <!--end::App-->

    <!--begin::Scrolltop-->
    <div id="kt_scrolltop" class="scrolltop" data-kt-scrolltop="true">
        <i class="ki-duotone ki-arrow-up">
            <span class="path1"></span>
            <span class="path2"></span>
        </i>
    </div>
    <!--end::Scrolltop-->

    <!--end::Modals-->
    <!--begin::Javascript-->
    <script>
        var hostUrl = "assets/";
    </script>
    <!--begin::Global Javascript Bundle(mandatory for all pages)-->
    <script src="assets/plugins/global/plugins.bundle.js"></script>
    <script src="assets/js/scripts.bundle.js"></script>
    <!--end::Global Javascript Bundle-->
    <!--begin::Vendors Javascript(used for this page only)-->


    <!--end::Vendors Javascript-->
    <!--begin::Custom Javascript(used for this page only)-->
    <script src="assets/js/widgets.bundle.js"></script>
    <script src="assets/js/custom/widgets.js"></script>

    <!--end::Custom Javascript-->
    <!--end::Javascript-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>

    <script src="assets/plugins/custom/fslightbox/fslightbox.bundle.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.11.3/viewer.min.js"></script>


    <script src="https://vjs.zencdn.net/ie8/ie8-version/videojs-ie8.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/videojs-contrib-hls/5.14.1/videojs-contrib-hls.js"></script>
    <!-- <script src="https://vjs.zencdn.net/7.2.3/video.js"></script> -->
    <script src="https://vjs.zencdn.net/8.3.0/video.min.js"></script>



    <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/xy.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/percent.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/radar.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
    <!-- <script src="https://cdn.socket.io/4.4.1/socket.io.esm.min.js"></script> -->
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"
        integrity="sha384-c79GN5VsunZvi+Q/WObgk2in0CbZsHnjEqvFxC5DxHn9lTfNce2WW6h2pH6u/kF+"
        crossorigin="anonymous"></script>
    <script type="module">
        // import { io } from "https://cdn.socket.io/4.4.1/socket.io.esm.min.js";

        // const socket = io();
        //  SOCKETIO Path : server_url : https://io-watch.adcm.co.th/io u

        // console.log(socket.id); // undefined
        // socket.io.on('feed/alarm', (data) => {
        //     // Handle alarm/emergency data
        //     console.log(data)
        // });
        // socket.on("connect", () => {
        //     const engine = socket.io.engine;
        //     console.log(engine.transport.name); // in most cases, prints "polling"



        // });
    </script>
    <script>

        var zippi = new Audio('emer.mp3')


        const socket = io("https://io-watch.adcm.co.th", {
            path: "/io"
        });

        socket.on('notification', (data) => {
            // console.log(`notification - ${data}`)
            console.log(data)
        });
        socket.on('feed/alarm', (data) => {
            console.log(data)
            // {
            //     "datetime": "2023-08-13 01:14:57",
            //     "location": {
            //         "latitude": 16.980616666666666,
            //         "longitude": 99.94906233333333
            //     },
            //     "alarm_state": "06",
            //     "battery_level": "050",
            //     "payload": {
            //         "identifier": "IW",
            //         "commandWord": "AP10",
            //         "date": "2023-08-12",
            //         "dataValidity": "A",
            //         "lbsData": "1658.83700N09956.94374E000",
            //         "gmtTime": ".41814",
            //         "directionAngle": "57000.",
            //         "gsmSignal": "001",
            //         "satellites": "000",
            //         "batteryLevel": "050",
            //         "remainingSpace": "5",
            //         "fortificationState": "40",
            //         "workingMode": "0003",
            //         "lbsBaseData": {
            //             "mcc": "520",
            //             "mnc": "3",
            //             "lac": "16392",
            //             "cid": "42009457"
            //         },
            //         "alarmState": "06",
            //         "deviceLanguage": "zh-cn",
            //         "replyAddress": "0",
            //         "mobileHyperlink": "0",
            //         "wifiInformation": [
            //             {
            //                 "ssid": "a",
            //                 "macAddress": "28-de-e5-91-25-3c",
            //                 "signalStrength": "68"
            //             }
            //         ]
            //     },
            //     "metadata": null,
            //     "smart_watch_id": 2,
            //     "imei": "865513041164663"
            // }

            var latitude , longitude 
            var txtMap = "Open Google Map";

            if(data?.location){
                latitude = data.location.latitude ;
                longitude = data.location.longitude ;
            }else{

                latitude = 0
                longitude = 0
                txtMap = 'ไม่มี location';

            }

            Swal.fire({
                icon: 'warning',
                title: '! - Alert - !',
                text: `${data.imei} : มีการร้องขอความช่วยเหลือ !\n ${data.datetime}`,
                confirmButtonText: '<i class="fa-solid fa-xmark"></i> ปิด <i class="fa-solid fa-xmark"></i>',
                footer: `<a href='https://www.google.com/maps/search/?api=1&query=${latitude},${longitude}' target='_blank'>
						<span>${txtMap}</span>
					</a>`,
                didOpen: function () {
                    zippi.play();
                },
                willClose: () => {
                    // clearInterval(timerInterval)
                    zippi.pause();
                    zippi.currentTime = 0;
                }
            })
        });



        // Then, show one image by click it, or call `gallery.show()`.
        let imei_g = "865513041161826";
        let typeSelect = 'heartrate';
        let gen_kt_charts = false;
        let gen_kt_charts2 = false;
        let series, xAxis, series_2, series_22;
        let arTop10 = [];
        let top_list = [];



        var player = videojs('hls-example');
        // player.play();

        // player.src(x)

        function setVideo(x) {
            // console.log(x)
            // console.log(player)
            // player.changeSource(x);


            player.src(x)
            // $('#hls-example-source').attr('src' , x)
            // player.reconnect();

            // player = videojs('hls-example');
            // player.load();
            // if (!player.paused) {
            // 	player.pause();
            // }
            // player.load();
            player.play();

        }

        $('#select_type').on('change', function () {
            $(this).val();
            genChartToplist($(this).val())

        })

        getWatchList().then(response => {
            console.log(response);

            response.data.forEach((element, index) => {
                $("#select_imei").append(
                    `<option value='${element.imei}'>imei ${element.imei}</option>`
                )
                if (index == 0) {
                    setW(element.imei);
                }
            })


        }).then(() => {

            $("#select_imei").on('change', function () {
                var imei = $(this).val();
                setW(imei);
            })

        })

        function setW(imei) {

            $('#select_type').val('heartrate')
            getWatchImei(imei).then(response => {
                // console.log(response);
                $('#txt_imei').html(response.message);
                $('#txt_last_update').html(response.data.last_update);
                let last_health = response.data.last_health;


                $('#txt_temperature').html(fnNull(last_health.temperature.value));
                $('#txt_heart_rate').html(fnNull(last_health.heartrate.value));
                $('#txt_sbp').html(fnNull(last_health.sbp.value) + ' / ' + fnNull(last_health.dbp.value));
                $('#txt_spo2').html(fnNull(last_health.spo2.value));
                $('#txt_bs').html(fnNull(last_health.bs.value));

            })
            getWatchHistory(imei).then(response => {
                // console.log(response)
                var i = 0;
                arTop10 = [];
                response.data.forEach(element => {
                    if (i == 10) {
                        return false;
                    } else {
                        arTop10.push(element)
                        i++;

                    }
                })
                genChartToplist(typeSelect)
            })

        }
        async function getWatchList() {



            const response = await fetch(`https://api-watch.adcm.co.th/v1/watch/`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json;charset=utf-8',
                }
            })

            const allData = await response.json();
            return allData;

        }

        async function getWatchImei(imei) {

            const response = await fetch(`https://api-watch.adcm.co.th/v1/watch/imei/${imei}`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json;charset=utf-8',
                }
            })

            const allData = await response.json();
            return allData;

        }

        async function getWatchHistory(imei) {

            const response = await fetch(`https://api-watch.adcm.co.th/v1/health/imei/${imei}`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json;charset=utf-8',
                }
            })

            const allData = await response.json();
            return allData;

        }

        function fnNull(x) {
            if (x == null) {
                return '-';
            } else {
                return x;
            }
        }



        function genChartToplist(typeSelect) {
            $('#kt_amcharts').hide();

            $('#kt_amcharts2').hide();

            console.log(typeSelect);
            top_list = [];
            if (typeSelect == 'temperature') {

                arTop10.forEach(element => {
                    top_list.push({
                        count: element.temperature,
                        name: element.datetime
                    })

                })

            } else if (typeSelect == 'heartrate') {

                arTop10.forEach(element => {
                    top_list.push({
                        count: element.heart_rate,
                        name: element.datetime
                    })

                })

            } else if (typeSelect == 'spo2') {
                arTop10.forEach(element => {
                    top_list.push({
                        count: element.spo2,
                        name: element.datetime
                    })

                })
            } else if (typeSelect == 'sbp') {

            }




            if (typeSelect == 'sbp') {

                $('#kt_amcharts2').show();
                var data = [];
                // Set data
                // "datetime": "2023-08-12 13:06:31",
                //     "temperature": null,
                //         "heart_rate": 106,
                //             "sbp": 124,
                //                 "dbp": 77,
                //                     "spo2": 97,
                //                         "bs": null
                arTop10.forEach(element => {

                    // var dateX = element.datetime.substring(0, 10)
                    data.push(
                        {
                            date: new Date(element.datetime).getTime(),
                            // date: element.datetime ,
                            value1: element.sbp,
                            value2: element.dbp,
                            // previousDate: element.datetime
                        }
                    );

                })

                if (gen_kt_charts2) {

                    series_2.data.setAll(data);
                    series_22.data.setAll(data);
                    return false;
                }


                // console.log(data)
                // console.log(data2)
                am5.ready(function () {
                    gen_kt_charts2 = true;
                    // Create root element
                    // https://www.amcharts.com/docs/v5/getting-started/#Root_element
                    var root = am5.Root.new("kt_amcharts2");


                    // Set themes
                    // https://www.amcharts.com/docs/v5/concepts/themes/
                    root.setThemes([
                        am5themes_Animated.new(root)
                    ]);


                    // Create chart
                    // https://www.amcharts.com/docs/v5/charts/xy-chart/
                    var chart = root.container.children.push(am5xy.XYChart.new(root, {
                        panX: true,
                        panY: true,
                        wheelX: "panX",
                        wheelY: "zoomX",
                        pinchZoomX: true
                    }));

                    chart.get("colors").set("step", 3);


                    // Add cursor
                    // https://www.amcharts.com/docs/v5/charts/xy-chart/cursor/
                    var cursor = chart.set("cursor", am5xy.XYCursor.new(root, {}));
                    cursor.lineY.set("visible", false);


                    // Create axes
                    // https://www.amcharts.com/docs/v5/charts/xy-chart/axes/
                    var xAxis = chart.xAxes.push(am5xy.DateAxis.new(root, {
                        maxDeviation: 0.3,
                        baseInterval: {
                            timeUnit: "minute",
                            count: 1
                        },
                        renderer: am5xy.AxisRendererX.new(root, {}),
                        tooltip: am5.Tooltip.new(root, {})
                    }));


                    var yAxis = chart.yAxes.push(am5xy.ValueAxis.new(root, {
                        maxDeviation: 0.3,
                        renderer: am5xy.AxisRendererY.new(root, {})
                    }));


                    // Add series
                    // https://www.amcharts.com/docs/v5/charts/xy-chart/series/
                    series_2 = chart.series.push(am5xy.LineSeries.new(root, {
                        name: "Series 1",
                        xAxis: xAxis,
                        yAxis: yAxis,
                        valueYField: "value1",
                        valueXField: "date",
                        tooltip: am5.Tooltip.new(root, {
                            // labelText: "SBP:{value1} \nDBP: {value2}"
                            labelText: "{valueX}: {valueY}\n{previousDate}: {value2}"


                        })
                    }));

                    series_2.strokes.template.setAll({
                        strokeWidth: 2
                    });

                    series_2.get("tooltip").get("background").set("fillOpacity", 0.5);

                    series_22 = chart.series.push(am5xy.LineSeries.new(root, {
                        name: "Series 2",
                        xAxis: xAxis,
                        yAxis: yAxis,
                        valueYField: "value2",
                        valueXField: "date",
                    }));

                    series_22.strokes.template.setAll({
                        strokeDasharray: [2, 2],
                        strokeWidth: 2
                    });

                    // Set date fields
                    // https://www.amcharts.com/docs/v5/concepts/data/#Parsing_dates
                    root.dateFormatter.setAll({
                        dateFormat: "yyyy-MM-dd",
                        dateFields: ["valueX"]
                    });


                    // // Set data
                    // var data = [{
                    //     date: new Date(2019, 5, 12).getTime(),
                    //     value1: 50,
                    //     value2: 48,
                    //     previousDate: new Date(2019, 5, 5)
                    // }, {
                    //     date: new Date(2019, 5, 13).getTime(),
                    //     value1: 53,
                    //     value2: 51,
                    //     previousDate: "2019-05-06"
                    // }, {
                    //     date: new Date(2019, 5, 14).getTime(),
                    //     value1: 56,
                    //     value2: 58,
                    //     previousDate: "2019-05-07"
                    // }, {
                    //     date: new Date(2019, 5, 15).getTime(),
                    //     value1: 52,
                    //     value2: 53,
                    //     previousDate: "2019-05-08"
                    // }, {
                    //     date: new Date(2019, 5, 16).getTime(),
                    //     value1: 48,
                    //     value2: 44,
                    //     previousDate: "2019-05-09"
                    // }, {
                    //     date: new Date(2019, 5, 17).getTime(),
                    //     value1: 47,
                    //     value2: 42,
                    //     previousDate: "2019-05-10"
                    // }, {
                    //     date: new Date(2019, 5, 18).getTime(),
                    //     value1: 59,
                    //     value2: 55,
                    //     previousDate: "2019-05-11"
                    // }]

                    series_2.data.setAll(data);
                    series_22.data.setAll(data);


                    // Make stuff animate on load
                    // https://www.amcharts.com/docs/v5/concepts/animations/
                    series_2.appear(1000);
                    series_22.appear(1000);
                    chart.appear(1000, 100);

                }); // end am5.ready()


            } else {
                $('#kt_amcharts').show();

                if (gen_kt_charts) {
                    xAxis.data.setAll(top_list);
                    series.data.setAll(top_list);

                    return false;
                }
                am5.ready(function () {

                    gen_kt_charts = true;
                    // Create root element
                    // https://www.amcharts.com/docs/v5/getting-started/#Root_element
                    var root = am5.Root.new("kt_amcharts");


                    // Set themes
                    // https://www.amcharts.com/docs/v5/concepts/themes/
                    root.setThemes([
                        am5themes_Animated.new(root)
                    ]);


                    // Create chart
                    // https://www.amcharts.com/docs/v5/charts/xy-chart/
                    var chart = root.container.children.push(am5xy.XYChart.new(root, {
                        panX: true,
                        panY: true,
                        wheelX: "panX",
                        wheelY: "zoomX",
                        pinchZoomX: true
                    }));

                    // Add cursor
                    // https://www.amcharts.com/docs/v5/charts/xy-chart/cursor/
                    var cursor = chart.set("cursor", am5xy.XYCursor.new(root, {}));
                    cursor.lineY.set("visible", false);


                    // Create axes
                    // https://www.amcharts.com/docs/v5/charts/xy-chart/axes/
                    var xRenderer = am5xy.AxisRendererX.new(root, {
                        minGridDistance: 30
                    });
                    xRenderer.labels.template.setAll({
                        rotation: -45,
                        centerY: am5.p50,
                        centerX: am5.p100,
                        paddingRight: 15
                    });

                    xAxis = chart.xAxes.push(am5xy.CategoryAxis.new(root, {
                        maxDeviation: 0.3,
                        categoryField: "name",
                        renderer: xRenderer,
                        tooltip: am5.Tooltip.new(root, { labelText: "[bold]{name}[/]{sbp} " }),
                        tooltipText: "{name}, {categoryX}: {valueY}"
                    }));

                    var yAxis = chart.yAxes.push(am5xy.ValueAxis.new(root, {
                        maxDeviation: 0.3,
                        renderer: am5xy.AxisRendererY.new(root, {})
                    }));


                    // Create series
                    // https://www.amcharts.com/docs/v5/charts/xy-chart/series/
                    series = chart.series.push(am5xy.ColumnSeries.new(root, {
                        name: "Series 1",
                        xAxis: xAxis,
                        yAxis: yAxis,
                        valueYField: "count",
                        sequencedInterpolation: true,
                        categoryXField: "name",
                        tooltip: am5.Tooltip.new(root, {
                            labelText: "{valueY}"
                        })
                    }));

                    series.columns.template.setAll({
                        cornerRadiusTL: 5,
                        cornerRadiusTR: 5
                    });
                    series.columns.template.adapters.add("fill", function (fill, target) {
                        // console.log(chart.get("colors").getIndex(series.columns.indexOf(target)))
                        return '#006838';
                    });

                    // series.columns.template.adapters.add("stroke", function(stroke, target) {
                    //     return chart.get("colors").getIndex(series.columns.indexOf(target));
                    // });




                    xAxis.data.setAll(top_list);
                    series.data.setAll(top_list);


                    // Make stuff animate on load
                    // https://www.amcharts.com/docs/v5/concepts/animations/
                    series.appear(1000);
                    chart.appear(1000, 100);

                    console.log(root);
                }); // end am5.ready()

            }











        }



        function sbpAndDbp(sbp, dbp) {
            console.log(sbp, dbp)
            if (sbp > 139 && dbp > 100) {
                return 4;
            } else if ((sbp >= 140 && sbp <= 159) && (dbp >= 90 && dbp <= 99)) {
                return 3;

            } else if ((sbp >= 121 && sbp <= 139) && (dbp >= 80 && dbp <= 89)) {
                return 2;

            } else if ((sbp >= 121 && sbp <= 139) || (dbp >= 80 && dbp <= 89)) {
                return 2;

            } else if (sbp < 129 && dbp < 80) {
                return 1;

            }

        }
    </script>
</body>
<!--end::Body-->

</html>